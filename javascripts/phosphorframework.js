/*!
 * Phosphor Framework 1.0.2
 * http://www.divergentmedia.com/phosphor
 *
 * Copyright 2013, divergent media, inc.
 * Licensed under the MIT license.
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 *  "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 */
function PhosphorPlayer(e){var t=this;this.bindId=e,this.frameworkVersion=1;var n=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=0,r=0,i=[],s=function(e){if(!e)return;var n,r,s,o,u,a,f,l=0,c=0,h=e.length/4*3;for(l=0;l<h;l+=3)o=t.indexOf(e.charAt(c++)),u=t.indexOf(e.charAt(c++)),a=t.indexOf(e.charAt(c++)),f=t.indexOf(e.charAt(c++)),n=o<<2|u>>4,r=(u&15)<<4|a>>2,s=(a&3)<<6|f,i.push(n),i.push(r),i.push(s)},o=function(){while(r<0)n--,r+=8;while(r>7)n++,r-=8},u=function(){var e=f(8);return e},a=function(e){var t=0,n;for(n=0;n<e;n++)t=(t<<8)+u();return t},f=function(e){var t=0;e>8&&(t+=f(8)<<e-8,e-=8);if(r+e>8){var s=8-r;t+=f(s)<<e-s,e-=s}var u=8-e-r,a=255>>8-e;a<<=u;var l=i[n]&a;return t+=l>>u,r+=e,o(),t},l=function(e){n+=e},c=function(e){r+=e,o()},h=function(){return n>=i.length},p=function(){return n},d=function(e,t){n=e,r=t,o()},v=function(){return i.length};return s(e),{readByte:u,readBytes:a,readBits:f,skipBytes:l,skipBits:c,eof:h,bytePos:p,jumpToOffsetByteBits:d,byteLength:v}};this._debug=!1,this._canvas=null,this._imgArray=[],this._animationId=-1,this._currentFrameNumber=0,this._frameCount=0,this._loop=!1,this._jsonData=null,this._atlasImagetheresLoaded=!1,this._onLoadHandler="",this._currentFrameCallback=null,this._playbackFinishedCallback=null;var r=function(e){var n=t._canvas.getContext("2d"),r="Phosphor Framework Version Mismatch!",i=n.measureText(r);n.fillStyle="red",n.fillRect(t._canvas.width/2-i.width/2-5,t._canvas.height/2-20,i.width+25,30),n.fillStyle="white",n.font="normal 12px Letter Faces",n.fillText(r,t._canvas.width/2-i.width/2,t._canvas.height/2),console.log(r+" Confirm that your phosphor framework is the same or newer than the composition.  Composition version: "+e+", framework version: "+t.frameworkVersion)},i=function(e,r,i){i=typeof i=="undefined"?!1:i;var s=t._canvas.getContext("2d"),o=!1,u=n(e);if(u)while(u.byteLength()-u.bytePos()>10){u.skipBytes(1);var a=u.readByte(),f=u.readBits(5),l=u.readBits(3),c=u.readBytes(2),h=u.readBits(4),p=u.readBits(4),d=u.readBits(4),v=u.readBits(4),m=u.readBits(4),g=u.readBits(4),y=u.readBits(4);u.skipBits(52);if(l===0&&!o){o=!0;var b=t._jsonData.framesize.width,w=t._jsonData.framesize.height;s.clearRect(0,0,b,w)}var E=u.bytePos();for(var S=0;S<c;S++){var x=u.readBits(h)*f,T=u.readBits(h)*f,N=1*f,C=1*f;v>0&&(N=(u.readBits(v)+1)*f),m>0&&(C=(u.readBits(m)+1)*f);var k=u.readBits(p)*f,L=u.readBits(d)*f,A=N,O=C;g>0&&(A=(u.readBits(g)+1)*f),y>0&&(O=(u.readBits(y)+1)*f),l==1&&r&&s.clearRect(k,L,A,O),s.drawImage(t._imgArray[a],x,T,N,C,k,L,A,O),i&&(s.lineWidth="1",s.strokeStyle="red",s.strokeRect(k+1,L+1,A-2,O-2))}}},s=function(){var e=t._jsonData,n=e.version,s=t._canvas.getContext("2d");if(n>t.frameworkVersion){r(n);return}var o=e.hasAlpha,u=0,a=0,f=function(n){var r=e.frames;if(t._animationId===-1)return;if(u>0&&n-u<a){requestAnimationFrame(f);return}if(t._debug){var s=r[t._currentFrameNumber-1];s&&i(s.x,o)}var l=r[t._currentFrameNumber];if(l){var c=l.d;i(l.x,o,t._debug)}t._currentFrameCallback&&(l&&l.hasOwnProperty("m")?t._currentFrameCallback(t._currentFrameNumber,l.m):t._currentFrameCallback(t._currentFrameNumber,null)),t._currentFrameNumber++;if(t._currentFrameNumber==r.length){t._playbackFinishedCallback&&t._playbackFinishedCallback();if(!t._loop)return;t._currentFrameNumber=0}a=c*1e3/e.timescale,u=n,t._animationId=requestAnimationFrame(f)};t._animationId=requestAnimationFrame(f)},o=function(){var e=t._jsonData,n=e.version,s=t._canvas.getContext("2d");if(n>t.frameworkVersion){r(n);return}var o=e.hasAlpha,u=e.framesize.width,a=e.framesize.height,f=e.frames;o&&s.clearRect(0,0,u,a);var l=f[t._currentFrameNumber],c=l.d;i(l.x,o,t._debug)};this.load_animation=function(e){t._atlasImagesLoaded=!1,t.img_urls=e.imageArray,t.img_path=e.imagePath,t._onLoadHandler=e.onLoad,t._loop=e.loop,t._currentFrameCallback=e.currentFrameCallback,t._playbackFinishedCallback=e.playbackFinishedCallback,t.loadOneImage=function(){if(!(t.img_urls.length>0)){t._atlasImagesLoaded=!0,t._onLoadHandler();return}var e=new Image;e.onload=function(){t._imgArray.push(e),t.loadOneImage()},t.img_path&&t.img_path.length>0?e.src=t.img_path+t.img_urls.shift():e.src=t.img_urls.shift()},t.loadOneImage(),t._jsonData=e.animationData,t._frameCount=t._jsonData.frames.length},this.play=function(){if(t._animationId!==-1)return;t._canvas&&t._canvas.getContext&&t._jsonData&&t._atlasImagesLoaded?s():setTimeout(function(){t.play()},100)},this.stop=function(){if(t._animationId===-1)return;cancelAnimationFrame(t._animationId),t._animationId=-1},this.currentFrameNumber=function(){return t._currentFrameNumber},this.setCurrentFrameNumber=function(e){t._currentFrameNumber=e,o()},this.debug=function(e){t._debug=e},this.loop=function(e){t._loop=e};var u=function(e){var n=document.getElementById(e),r=n.parentNode;t._canvas=document.createElement("canvas");var i=t._canvas.getContext?!0:!1;if(!i)return!1;t._canvas.id=n.id,t._canvas.width=n.width,t._canvas.height=n.height,t._canvas.style.cssText="display:block;";if(n.complete){r.replaceChild(t._canvas,n);var s=t._canvas.getContext("2d");s.drawImage(n,0,0)}else n.onload=function(){r.replaceChild(t._canvas,n);var e=t._canvas.getContext("2d");e.drawImage(n,0,0)}};u(e)}(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();